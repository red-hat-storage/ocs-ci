# Usage

**Work in progress**


`run.py` - (**deprecated**) is the main script for ocs-ci. You can view the
full usage details by passing in the `--help` argument.

For pytest run python -m run_ocsci --help

```bash
python run.py --help
```

## Required configuration

* **AWS credentials** - if you have AWS already configured by `aws configure`,
    see:
    [AWS doc](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html)
    there shouldn't be need of any additional configuration for AWS. If not,
    please make sure you configure your AWS credentials via `aws configure`
    command, or you have proper configuration done in `~/.aws` folder which is
    usually generated by mentioned command.

## Required arguments

There are a few arguments that are required ocs test execution:

* `--suite <suite_file>`

## Useful pytest arguments

Some non-required arguments that we end up using a lot. You can use
`python -m run_ocsci --help` to see all the parameters and description which you can pass
to the pytest.

* `--capture=no` - when using pdb or ipdb you have to turn of capture mode
    for pytest.
* `-m "tier1 and ecosystem"` - This will select just tests marked with
    tier1 and ecosystem marks.


### Parameters already converted to pytest:

* `--cluster-name <name>` - name of cluster.
* `--cluster-path <path>` - path where to create the directory which will
    contains all the installation/authentication information about cluster.
    `Use this parameter when running on already deployed cluster!` You can
    pass the cluster path from previous execution if was created automatically.
* `--ocsci-conf` - with this configuration you can overwrite the default
    OCS-CI parameters defined in `conf/ocsci/default_config.yaml`
* `--cluster-conf` - with this configuration you can overwrite the default
    parameters for cluster and deployment. See the example of such file
    [here](../conf/ocs_basic_install.yml).

### Parameters for old runner:

>TODO: Delete this section once moved to pytest and move missing parameters above!

* `--cluster-name <name>` - name of cluster.
* `--cluster-path <path>` - path where to create the directory which will
    contains all the installation/authentication information about cluster.
    `Use this parameter when running on already deployed cluster!` You can
    pass the cluster path from previous execution if was created automatically.
* `--conf` - with this configuration you can overwrite the default
    parameters for cluster and deployment. See the example of such file
    [here](../conf/ocs_basic_install.yml).
* `--no-destroy` - this will prevent you to destroy your cluster at the end of
    the execution. (Recommended if you want to re-run on the same cluster)
* `--log-level <level>` - set the log level that is output to stdout.

## Examples

### For old runner

* Run OCS install suite:

```bash
python run.py --suite suites/ocs_basic_install.yml --log-level info
```

* Run with specific name of cluster and cluster directory without sending email:

```bash
python run.py --cluster-name=my-testing-cluster \
    --suite=suites/custom-test.yml \
    --cluster-path=/home/your_login/my-testing-cluster \
    --no-email
```

### For pytest

**WORK IN PROGRESS:**
There is still work in progress and we didn't moved cleanup of cluster to
pytest yet, will be done in different PR.

> Destroy of cluster can be done with old runner till we move this to pytest.
> Or with `uni-cleanup.sh` script.

Also there is no order yet for
deployment and running tests, so currently you are not able to run deployment
and test in one execution. This will be done also in new PR with pytest
ordering plugin or different way if we will decide.

So for now please deploy cluster with one execution of `pytest` and run tests
on existing cluster with second execution of `pytest`!



#### Deployment of cluster
Deployment is moved already to pytest. If you would like to deploy new cluster
you can run folowing command:
```bash
python -m run_ocsci -m deployment --ocsci-conf conf/ocsci/custom_config.yaml \
    --cluster-conf conf/ocs_basic_install.yml \
    --cluster-name kerberos_ID-ocs-deployment \
    --cluster-path /home/my_user/my-ocs-dir tests/
 ```
of course you can utilize your cluster to add `--cluster-conf` parameter or
you can omit --cluster-name or --cluster-path if you would like to use default
values.

#### Runing tests on deployed environment

```bash
python -m run_ocsci -m "tier1 and manage" \
    --cluster-name kerberos_ID-ocs-deployment \
    --cluster-path /home/my_user/my-ocs-dir tests/
 ```
