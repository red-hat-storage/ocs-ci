

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Guidelines for fixtures usage in OCS-CI &mdash; OCS-CI  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Debugging" href="debugging.html" />
    <link rel="prev" title="Config directory" href="readmefiles/conf.README.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> OCS-CI
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Package documentations:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apidoc/modules.html">ocs_ci modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="code_review.html">Code review/contribution best practices in OCS-CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_guidelines.html">Coding guidelines for OCS-CI project</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_platforms.html">Supported platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#usage-for-getting-various-ocs-image-versions">usage for getting various ocs image versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#usage-for-cleanup">usage for cleanup</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#usage-to-shutdown-aws-nodes-when-nodes-are-not-in-use">usage to shutdown AWS nodes when nodes are not in use</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#usage-for-ocs-build-tool">Usage for ocs-build tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="results.html">Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_tests.html">Writing tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="stable_branch.html">Stable Branch</a></li>
<li class="toctree-l1"><a class="reference internal" href="readmefiles/conf.README.html">Config directory</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Guidelines for fixtures usage in OCS-CI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-information">Basic information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-cases">Use cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#avoid">Avoid</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples-of-fixtures-and-tests">Examples of fixtures and tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="unit_tests.html">Unit tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="workarounds.html">Tracking of workarounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_guidelines.html">OCS-CI Release Branches</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases/index.html">Common Use cases and FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="multicluster_test_example.html">Multi-cluster test example</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OCS-CI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Guidelines for fixtures usage in OCS-CI</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/fixture_usage.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="guidelines-for-fixtures-usage-in-ocs-ci">
<h1>Guidelines for fixtures usage in OCS-CI<a class="headerlink" href="#guidelines-for-fixtures-usage-in-ocs-ci" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basic-information">
<h2>Basic information<a class="headerlink" href="#basic-information" title="Permalink to this headline">¶</a></h2>
<p>What is a pytest Fixture? You can find definition and examples documentation in
<a class="reference external" href="https://docs.pytest.org/en/latest/fixture.html">pytest web</a>. Please read this
documentation first.</p>
<p>We should keep our fixtures organized and have all the dependencies well
defined in fixtures.</p>
<p>All the fixtures should be documented - documenting the return value is
mandatory.</p>
<p>Fixture is composed of its setup part, the code which is done for prepare
resource and teardown part which is after yield of added via
<code class="docutils literal notranslate"><span class="pre">request.addfinalizer</span></code> method. It’s strictly forced to use <code class="docutils literal notranslate"><span class="pre">addfinalizer</span></code>
method cause it can happen that what is after yield won’t be proceed when
exception will be thrown in the middle of the setup.</p>
<p>The finalizer should be added as soon as possible to make sure the finalizer
will be called at the end. (Otherwise we will hit the same issue as we have
with yield)</p>
</div>
<div class="section" id="use-cases">
<h2>Use cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h2>
<p>TODO: Mention function factories and use cases and when to use which approach.
Something like:</p>
<ul class="simple">
<li><p>Setup resource, test (using resources), teardown - regular usage of fixture</p></li>
<li><p>Test creating resources as part of test, teardown of resources - fixture
factory solve the issue here, see the
<a class="reference external" href="https://docs.pytest.org/en/latest/fixture.html#factories-as-fixtures">documentation</a></p></li>
<li><p>Setup resources,  test (using resources , deleting resources), teardown
shouldn’t fail on those deleted resources</p></li>
</ul>
</div>
<div class="section" id="avoid">
<h2>Avoid<a class="headerlink" href="#avoid" title="Permalink to this headline">¶</a></h2>
<p>Here is the list of things we should avoid in our fixtures:</p>
<ul class="simple">
<li><p>Using references to <code class="docutils literal notranslate"><span class="pre">request.node.cls</span></code> for setting, altering or reading class
attributes.</p></li>
<li><p>Using globals for sharing data.</p></li>
<li><p>Using yield.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.usefixtures</span></code>.</p></li>
<li><p>Using more than one assert in the teardown when another teardown action is
between them. (This will lead to a situation where the rest of resources
aren’t cleaned.</p></li>
</ul>
</div>
<div class="section" id="examples-of-fixtures-and-tests">
<h2>Examples of fixtures and tests<a class="headerlink" href="#examples-of-fixtures-and-tests" title="Permalink to this headline">¶</a></h2>
<p>Here are few simple examples of how to use fixtures.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/red-hat-storage/ocs-ci/tree/master/docs/python-examples/fixtures/conftest.py">conftest.py</a> - Example of fixture
definitions in conftest.py file for fixtures meant to be shared between tests.</p></li>
<li><p><a class="reference external" href="https://github.com/red-hat-storage/ocs-ci/tree/master/docs/python-examples/fixtures/test_fixtures.py">test_fixtures.py</a> - Examples of tests.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="debugging.html" class="btn btn-neutral float-right" title="Debugging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="readmefiles/conf.README.html" class="btn btn-neutral float-left" title="Config directory" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, OCS-QE

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>