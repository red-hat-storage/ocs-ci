apiVersion: ramendr.openshift.io/v1alpha1
kind: Recipe
metadata:
  name: PLACEHOLDER
spec:
  appType: busybox
  groups:
  - backupRef: PLACEHOLDER
    excludedResourceTypes:
    - events
    - event.events.k8s.io
    - persistentvolumes
    - replicaset
    - persistentvolumeclaims
    - pods
    includedNamespaces:
    - PLACEHOLDER
    labelSelector:
      matchExpressions:
      - key: workloadpattern
        operator: In
        values:
        - PLACEHOLDER
    name: PLACEHOLDER
    type: resource
  workflows:
  - failOn: any-error
    name: backup
    sequence:
    - hook: exec-check/busy
    - hook: backup/check-replicas
    - group: PLACEHOLDER
  - failOn: any-error
    name: restore
    sequence:
    - group: PLACEHOLDER
    - hook: restore/check-replicas
    - hook: exec-check/busy
  hooks:
  - name: exec-check
    nameSelector: PLACEHOLDER
    namespace: PLACEHOLDER
    selectResource: pod
    type: exec
    ops:
    - command: |
        ["/bin/sh", "-c", "ls"]
      name: busy
      inverseOp: busy-inv-same
    - command: |
        ["/bin/sh", "-c", "ls -lrt"]
      name: busy-inv-same
  - chks:
    - condition: '{$.spec.replicas} == {$.status.readyReplicas}'
      name: check-replicas
    name: backup
    nameSelector: PLACEHOLDER
    namespace: PLACEHOLDER
    onError: fail
    selectResource: deployment
    timeout: 300
    type: check
  - chks:
    - condition: '{$.spec.replicas} == {$.status.readyReplicas}'
      name: check-replicas
    name: restore
    nameSelector: PLACEHOLDER
    namespace: PLACEHOLDER
    onError: fail
    selectResource: deployment
    timeout: 300
    type: check
  volumes:
    includedNamespaces:
    - PLACEHOLDER
    name: mypvc
    type: volume
    labelSelector:
      matchExpressions:
      - key: appname
        operator: In
        values:
        - PLACEHOLDER
