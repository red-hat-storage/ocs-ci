[tox]
# Use a new pip so we can use PEP 508 URL requirements
requires = pip >= 19.1.1
envlist = py37,flake8

[default]
setenv =
    PY_MODULE=ocs_ci

[testenv]
basepython =
    py37: python3.7

    pypy3: pypy3

setenv =
    {[default]setenv}

deps =
    -rrequirements.txt
    pytest-cov
commands = py.test \
    --ignore=tests \
    -c pytest_unittests.ini \
    --cov=ocs_ci \
    {posargs}

[testenv:collectonly]
commands = py.test --collect-only tests

[testenv:flake8]
description = Run Flake8 (linter)
deps =
    flake8
    flake8-mutable
commands = flake8 {env:PY_MODULE} tests

[flake8]
ignore = E402, E741, W503
enable-extensions = M511
exclude =
    venv,
    .venv,
    .git,
    .github,
    .tox,
    __pycache__,
    .pytest_cache
max-line-length = 120
# We will change this to 79 in new PR with all the fixes of:
# https://travis-ci.org/red-hat-storage/ocs-ci/jobs/523393041

[testenv:docs]
deps =
    -rrequirements-docs.txt
commands = /usr/bin/make html
